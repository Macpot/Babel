<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas of Babel</title>
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'EB Garamond', serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #fff;
            color: #333333;
            text-align: center;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            max-width: 90vw;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #333333;
            letter-spacing: 1px;
        }

        canvas {
            margin-bottom: 20px;
            max-width: 100%;
            height: auto;
        }

        #controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }

        button, input {
            padding: 8px 15px;  
            margin: 5px;
            font-size: 1em;
            cursor: pointer;
            background-color: #fff;
            color: #333333;
            transition: background-color 0.3s, color 0.3s;
            height: 45px;
            line-height: normal;
            border: none;
            font-family: 'EB Garamond', serif;
            box-sizing: border-box;
        }

        input[type="text"] {
    width: 180px; 
    padding: 8px;
    font-size: 1em;
    border: none;  /* Remove default borders */
    outline: none; /* Remove the default focus outline */
    background-color: #fff;
    color: #333333;
    transition: background-color 0.3s, color 0.3s;
    border-radius: 0; /* Ensure no border radius */
}

input[type="text"]:focus {
    background-color: #f0f0f0; /* Slight background change on focus */
    color: #333333;
    outline: none; /* No focus outline */
    border-radius: 0; /* Keep the border-radius zero even on focus */
}


        button:hover, input:hover {
            background-color: #333333;
            color: #fff;
        }

        #locationDisplay {
            margin-top: 10px;
            font-size: 1.2em;
            color: #333333;
        }

        .description {
            margin-top: 20px;
            font-size: 1em;
            color: #333333;
            max-width: 600px;
            line-height: 1.6;
        }

        .back-link {
            margin-top: 30px;
            font-size: 1.1em;
            color: #333333;
            text-decoration: none;
            padding: 10px;
            transition: color 0.3s;
        }

        .back-link:hover {
            color: #666666;
        }

        /* Responsive design for smaller screens */
        @media screen and (max-width: 768px) {
            h1 {
                font-size: 2em;
            }

            canvas {
                width: 100%;
                height: auto;
            }

            button, input {
                padding: 8px 12px;
                font-size: 0.9em;
                height: 40px; 
            }

            input[type="text"] {
                width: 180px;
            }

            .description {
                font-size: 0.9em;
            }

            .back-link {
                font-size: 1em;
            }
        }

        @media screen and (max-width: 480px) {
            h1 {
                font-size: 1.8em;
            }

            button, input {
                padding: 7px 10px;
                font-size: 0.8em;
                height: 35px;
            }

            input[type="text"] {
                width: 160px;
            }

            .description {
                font-size: 0.8em;
            }

            .back-link {
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Canvas of Babel</h1>
        
        <canvas id="babelCanvas" width="640" height="416"></canvas>

        <div id="controls">
            <button id="prevImage">Previous</button>
            <button id="nextImage">Next</button>
            <input type="text" id="locationInput" placeholder="Enter Image Location">
            <button id="goToImage">Seek</button>
            <button id="downloadImage">Download</button>
        </div>

        <p id="locationDisplay">Location: 0</p>

        <p class="description">
            The Canvas of Babel generates every possible combination of pixels with 4096 colors. Explore the infinite possibilities 
            with each click, discovering random or meaningful images, artworks, and visions. Every image has its own unique "location" 
            in this endless visual library.
        </p>

        <a href="portal.html" class="back-link">Back to Portal</a> <!-- This is the "Back to Portal" link -->
    </div>

    <script>
        const canvas = document.getElementById('babelCanvas');
        const ctx = canvas.getContext('2d');
        const width = canvas.width;
        const height = canvas.height;
        let currentLocation = 0;  // Starting location (seed)

        // Function to generate an image based on the current location
        function generateImageFromLocation(location) {
            const seed = parseInt(location, 10);
            const rng = mulberry32(seed); // PRNG function

            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const r = Math.floor(rng() * 256);
                    const g = Math.floor(rng() * 256);
                    const b = Math.floor(rng() * 256);
                    ctx.fillStyle = `rgb(${r},${g},${b})`;
                    ctx.fillRect(x, y, 1, 1);
                }
            }

            // Display the current location
            document.getElementById('locationDisplay').textContent = `Location: ${location}`;
        }

        // PRNG function (same as before)
        function mulberry32(seed) {
            return function () {
                let t = seed += 0x6D2B79F5;
                t = Math.imul(t ^ t >>> 15, t | 1);
                t ^= t + Math.imul(t ^ t >>> 7, t | 61);
                return ((t ^ t >>> 14) >>> 0) / 4294967296;
            };
        }

        // Functions to go to the next or previous image
        function nextImage() {
            currentLocation++;
            generateImageFromLocation(currentLocation);
        }

        function prevImage() {
            if (currentLocation > 0) {
                currentLocation--;
                generateImageFromLocation(currentLocation);
            }
        }

        function goToImage() {
            const locationInput = document.getElementById('locationInput').value;
            if (locationInput) {
                currentLocation = parseInt(locationInput, 10);
                generateImageFromLocation(currentLocation);
            }
        }

        function downloadImage() {
            const link = document.createElement('a');
            link.download = `canvas_of_babel_${currentLocation}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        // Event listeners for the buttons
        document.getElementById('nextImage').addEventListener('click', nextImage);
        document.getElementById('prevImage').addEventListener('click', prevImage);
        document.getElementById('goToImage').addEventListener('click', goToImage);
        document.getElementById('downloadImage').addEventListener('click', downloadImage);

        // Generate the initial image
        generateImageFromLocation(currentLocation);
    </script>
</body>
</html>
